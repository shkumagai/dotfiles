#!/bin/bash

WINDOW_NAME=$(basename $0)

source ./base
source ${TMUX_ROOT}/bin/utils

function main ()
{
    get-passwds
    rows=$(get-row-per-host 3)

    tmux neww -n ${WINDOW_NAME}

    tmux selectp -t 0; tmux splitw -v -t ${WINDOW_NAME}.0; tmux resizep -t ${WINDOW_NAME}.0 -y ${rows}
    tmux selectp -t 1; tmux splitw -v -t ${WINDOW_NAME}.1; tmux resizep -t ${WINDOW_NAME}.1 -y ${rows}

    tmux selectp -t 0; tmux splitw -h -t ${WINDOW_NAME}.0; tmux resizep -t ${WINDOW_NAME}.0 -x 84
    tmux selectp -t 1; tmux splitw -h -t ${WINDOW_NAME}.1; tmux resizep -t ${WINDOW_NAME}.2 -x 124

    tmux selectp -t 3; tmux splitw -h -t ${WINDOW_NAME}.3; tmux resizep -t ${WINDOW_NAME}.3 -x 84
    tmux selectp -t 4; tmux splitw -h -t ${WINDOW_NAME}.4; tmux resizep -t ${WINDOW_NAME}.5 -x 124

    tmux selectp -t 6; tmux splitw -h -t ${WINDOW_NAME}.6; tmux resizep -t ${WINDOW_NAME}.6 -x 84
    tmux selectp -t 7; tmux splitw -h -t ${WINDOW_NAME}.7; tmux resizep -t ${WINDOW_NAME}.8 -x 124

    tmux display-panes

    tmux send -t ${WINDOW_NAME}.0  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-01 'top'" C-m
    tmux send -t ${WINDOW_NAME}.1  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-01 'tail -F /var/log/messages'" C-m
    tmux send -t ${WINDOW_NAME}.2  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-01 'dstat -tamsl'" C-m

    tmux send -t ${WINDOW_NAME}.3  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-02 'top'" C-m
    tmux send -t ${WINDOW_NAME}.4  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-02 'tail -F /var/log/messages'" C-m
    tmux send -t ${WINDOW_NAME}.5  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-02 'dstat -tamsl'" C-m

    tmux send -t ${WINDOW_NAME}.6  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-03 'top'" C-m
    tmux send -t ${WINDOW_NAME}.7  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-03 'tail -F /var/log/messages'" C-m
    tmux send -t ${WINDOW_NAME}.8  "$TMUX_ROOT/bin/auto_ssh.sh dynad-item-kvs-03 'dstat -tamsl'" C-m
}

# run
main "$@"
